# ============================================================
# Base configuration for Gardner EXP / ICM / TE experiments
# Shared across all tasks and tracks
# ============================================================

# Reproducibility
seed: 42
deterministic: true

# Paths
splits_dir: splits
images_root: data/blastocyst_Dataset/Images
out_dir: outputs

# Data
data:
  image_col: Image
  exp_col: EXP
  icm_col: ICM
  te_col: TE
  image_size: 224
  num_workers: 2

# Training
train:
  epochs: 60
  batch_size: 64
  precision: 32
  gradient_clip_val: 0.0

# Optimization (default; can be overridden by track config)
optimizer:
  name: adam
  lr: 5.0e-4
  weight_decay: 0.0

scheduler:
  name: cosine
  warmup_epochs: 5
  warmup_lr: 0.000001

# SWA: disable by default (can hurt macro-F1 on imbalanced ordinal-ish EXP)
swa:
  use: false
  start_epoch: 30
  lr: 0.00025

# CORAL threshold tuning (only meaningful when use_coral=true in task cfg)
coral_tuning:
  tune: true
  thr_min: 0.05
  thr_max: 0.50
  thr_step: 0.01

# Augmentation (applied ONLY during training)
# Default tuned for EXP (global-shape sensitive). Override in ICM/TE if needed.
augmentation:
  random_resized_crop: true
  rrc_scale: [0.95, 1.0]
  rrc_ratio: [0.98, 1.02]
  rotation_deg: 5
  horizontal_flip: true
  vertical_flip: false
  color_jitter: false        # IMPORTANT: off for microscope images

# Sampling (off by default; enable in track/task if desired)
sampling:
  use_weighted_sampler: false
  use_sqrt_inverse: false
  cap_ratio: 5.0

# Model (IVF-EffiMorphPP)
model:
  name: ivf_effimorphpp
  dropout: 0.3
  pretrained: false
  width_mult: 1.0
  depth_mult: 1.0
  use_xception_mid: false
  use_late_mhsa: false
  mhsa_layers: 1
  mhsa_heads: 4
  use_gem: true
  head_mlp: true
  head_hidden_dim: null
  head_dropout: 0.0

# Loss defaults (override in task cfg)
loss:
  name: cross_entropy
  label_smoothing: 0.0
  focal_gamma: null

# Class weighting defaults (override in task cfg)
use_class_weights: false

# Metrics
metrics:
  primary: macro_f1
  compute_confusion_matrix: true

checkpoint:
  save_best_only: true
  save_last: false

# Logging
logging:
  log_every_n_steps: 50
  enable_progress_bar: true

# Sanity checks
sanity_checks:
  print_label_distribution: true
  assert_valid_labels: true

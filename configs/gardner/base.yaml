# ============================================================
# Base configuration for Gardner EXP / ICM / TE experiments
# Shared across all tasks and tracks
# ============================================================

# Reproducibility
seed: 42
deterministic: true

# Paths
splits_dir: splits
images_root: data/blastocyst_Dataset/Images
out_dir: outputs

# Data
data:
  image_col: Image
  exp_col: EXP
  icm_col: ICM
  te_col: TE
  image_size: 224
  num_workers: 2

# Training
train:
  epochs: 60
  batch_size: 64
  precision: 32              # set 16 if using AMP
  gradient_clip_val: 0.0

# Optimization (default; can be overridden by track config)
optimizer:
  name: adam
  lr: 5.0e-4
  weight_decay: 0.0

scheduler:
  name: cosine
  warmup_epochs: 5
  warmup_lr: 0.000001

sampling:
  use_sqrt_inverse: false
  cap_ratio: 5.0

swa:
  use: false
  start_epoch: 30
  lr: 0.00025

coral_tuning:
  tune: true
  thr_min: 0.30
  thr_max: 0.70
  thr_step: 0.01
# Augmentation (applied ONLY during training)
augmentation:
  random_resized_crop: true
  rrc_scale: [0.95, 1.0]
  rrc_ratio: [0.98, 1.02]
  rotation_deg: 5
  horizontal_flip: true
  vertical_flip: false
# Model (IVF-EffiMorphPP)
model:
  name: ivf_effimorphpp
  dropout: 0.3
  pretrained: false          # train from scratch (paper-consistent)
  width_mult: 1.2
  depth_mult: 1.0
  use_xception_mid: true
  use_late_mhsa: false
  mhsa_layers: 1
  mhsa_heads: 4
  use_gem: true
  head_mlp: true
  head_hidden_dim: null
  head_dropout: 0.0

# Loss defaults (overridden by track config)
loss:
  name: cross_entropy
  class_weight_mode: effective_num
  class_weight_beta: 0.999
  class_weight_cap: 10.0

# Class weighting (overridden by track config)
use_class_weights: true

# Metrics
metrics:
  primary: macro_f1
  compute_confusion_matrix: true


checkpoint:
  save_best_only: true
  save_last: false

# Logging
logging:
  log_every_n_steps: 50
  enable_progress_bar: true

# Sanity checks (highly recommended)
sanity_checks:
  print_label_distribution: true
  assert_valid_labels: true
